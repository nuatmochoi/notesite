<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Router, PWA | Vue.js Lecture Note</title>
    <meta name="description" content="">
    <link rel="icon" href="/notesite/images/icon-144x144.png">
  <link rel="manifest" href="/notesite/manifest.json">
    
    <link rel="preload" href="/notesite/assets/css/0.styles.096013c7.css" as="style"><link rel="preload" href="/notesite/assets/js/app.7598ef95.js" as="script"><link rel="preload" href="/notesite/assets/js/2.2b413f48.js" as="script"><link rel="preload" href="/notesite/assets/js/10.af6dba14.js" as="script"><link rel="preload" href="/notesite/assets/js/3.9a023001.js" as="script"><link rel="prefetch" href="/notesite/assets/js/11.cda827c0.js"><link rel="prefetch" href="/notesite/assets/js/12.abd301ab.js"><link rel="prefetch" href="/notesite/assets/js/13.7c59abbc.js"><link rel="prefetch" href="/notesite/assets/js/14.32cf25ee.js"><link rel="prefetch" href="/notesite/assets/js/4.a57bf471.js"><link rel="prefetch" href="/notesite/assets/js/5.48a0f058.js"><link rel="prefetch" href="/notesite/assets/js/6.33446d39.js"><link rel="prefetch" href="/notesite/assets/js/7.63882a72.js"><link rel="prefetch" href="/notesite/assets/js/8.8247d324.js"><link rel="prefetch" href="/notesite/assets/js/9.ea0270c8.js">
    <link rel="stylesheet" href="/notesite/assets/css/0.styles.096013c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notesite/" class="home-link router-link-active"><!----> <span class="site-name">Vue.js Lecture Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/notesite/" class="sidebar-link">Introduction</a></li><li><a href="/notesite/02.html" class="sidebar-link">Event, Instance, Component, Axios</a></li><li><a href="/notesite/03.html" class="sidebar-link">Directives, npm, Vue CLI, Component</a></li><li><a href="/notesite/04.html" class="sidebar-link">Event Bus, Life Cycle, ES6</a></li><li><a href="/notesite/05.html" class="sidebar-link">Render, Webpack, Vuex</a></li><li><a href="/notesite/06.html" class="active sidebar-link">Router, PWA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notesite/06.html#vue-router" class="sidebar-link">Vue Router</a></li><li class="sidebar-sub-header"><a href="/notesite/06.html#pwa" class="sidebar-link">PWA</a></li></ul></li><li><a href="/notesite/07.html" class="sidebar-link">Deployment with Vue CLI, PWA</a></li><li><a href="/notesite/08.html" class="sidebar-link">PWA Push Web App</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="router-pwa"><a href="#router-pwa" class="header-anchor">#</a> Router, PWA</h1> <h2 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> Vue Router</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> vue-router
</code></pre></div><p>페이지 전체 정보가 routes 라는 곳에 들어가게 된다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/router/index.js</span>
<span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token string">'/home'</span><span class="token punctuation">,</span>
    component<span class="token operator">:</span> HomePage
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>이 정도로 path마다 뿌려지는 component 구현으로 충분하지만, tag를 정의하기 위해서 router view를 정의한다.
<!----></p> <ul><li>mode</li></ul> <p>vue-router의 기본 모드는 <em>hash mode</em>. URL이 변경될 떄 페이지가 다시 로드되지 않음</p> <p>변경을 위해 history 모드 사용 가능. 페이지를 다시 로드하지 않아도 URL 탐색 가능</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'history'</span><span class="token punctuation">,</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>router-link</li></ul> <p>a href와의 차이 : to, replace 등의 vue-router에서 제공해주는 기능 제공 여부. router-link를 사용함으로써 히스토리 관리를 하지 않는 기능이라든지, to 속성에 parameter 등을 넘길 수 있게 된다.</p> <p>url을 바꿨는데도 서버로 가지 않고 js파일로 조작이 어떻게 가능한가? -&gt; <a href="https://developer.mozilla.org/ko/docs/Web/API/Window/history" target="_blank" rel="noopener noreferrer">window history<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>router 구성방법</li></ul> <ol><li>기본 방식 : 요구사항이 많이 바뀌는 경우에 사용 (단순하게 구성)</li> <li>nested router</li> <li>named view</li></ol> <ul><li>SPA(Single Page Application)</li></ul> <p><img src="https://docs.microsoft.com/en-us/archive/msdn-magazine/2013/november/images/dn463786.wasson_figure2_hires(en-us%2cmsdn.10).png" alt="SPA lifecycle"></p> <p>예전에는 화면에 바뀌는 것을 수정하기 위해서 전체 파일을 받아오기 위해 서버까지 접근했는데,
요즘에는 바뀌는 부분만 서버에 가서 요청함. 해당 역할을 vue router가 수행</p> <h3 id="navigation-gaurd"><a href="#navigation-gaurd" class="header-anchor">#</a> Navigation gaurd</h3> <div class="language-js extra-class"><pre class="language-js"><code>routes<span class="token operator">:</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
		path<span class="token operator">:</span> <span class="token string">&quot;/home&quot;</span><span class="token punctuation">,</span>
		component<span class="token operator">:</span> Home
		<span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					path<span class="token operator">:</span> <span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span>
					query<span class="token operator">:</span> <span class="token punctuation">{</span> redirect<span class="token operator">:</span> to<span class="token punctuation">.</span>fullPath <span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>로컬 스토리지에 key가 있는지 확인하고 없으면 login 화면으로 넘기는 로직이다.</li> <li>위 예시와 같이 네비게이션 가드를 통해 특정 라우팅에 대해 가드를 설정할 수 있다.</li> <li>쉽게 말해, 특정 컴포넌트로 이동하기 전에 조건 처리를 통해 로그인이 되었는지 등 검증 로직을 수행할 수 있는 방법이다.</li></ul> <h2 id="pwa"><a href="#pwa" class="header-anchor">#</a> PWA</h2> <p>Workbox가 가장 최신의 라이브러리이다.</p> <ul><li>모바일 앱과 같은 경험을 주는 최신 웹 앱</li> <li>앱 icon, 앱 설치 banner, 모바일 push(notification), offline 경험 제공</li> <li>html, css, js로 모바일과 같은 웹앱 구현</li> <li>높은 사용자 경험을 제공하기 위한 웹앱 (페이징 속도를 올리는 등)</li></ul> <p><a href="https://vuejsdevelopers.com/" target="_blank" rel="noopener noreferrer">https://vuejsdevelopers.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://dev.to/" target="_blank" rel="noopener noreferrer">https://dev.to<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 와 같은 사이트들이 PWA로 개발이 되었다. 웹 어플리케이션으로 설치가 가능한 것을 확인할 수 있다. <a href="https://pwa.rocks/" target="_blank" rel="noopener noreferrer">https://pwa.rocks/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 여기에서 더 많은 PWA 사이트를 확인 할 수 있다.</p> <h3 id="pwa-특징"><a href="#pwa-특징" class="header-anchor">#</a> PWA 특징</h3> <ul><li>App-like (Mobile App과 동일한 icon based 실행방식과 UX을 제공)</li> <li>Discoverable (url로 사이트 접근 후 banner를 통해 oneclick 설치 가능)</li> <li>Engagable (push 알람이 왔을 때 다시 앱으로 유입)</li> <li>Connectivity (오프라인 웹앱 - 인터넷이 끊겨도 웹사이트가 잘 동작함)</li> <li>https 위에서만 동작한다.</li> <li>포보스나 익스페디아 등 많은 기업에서 사용한다.</li> <li>일반 웹사이트와 동작이 다르다. PWA는 앱으로 설치하고 실행했을 때, launching image가 있어 모바일 앱 같아 보이고, 위에 url bar가 존재하지 않는 것을 확인할 수 있다.</li></ul> <h3 id="pwa를-구성하는-기술"><a href="#pwa를-구성하는-기술" class="header-anchor">#</a> PWA를 구성하는 기술</h3> <ol><li>Web App Manifest (manifest.json)</li> <li>Service Workers (client-side javascript proxy) - 웹앱과 webserver 사이에 존재 (caching)</li></ol> <h3 id="pwa-지원-브라우저"><a href="#pwa-지원-브라우저" class="header-anchor">#</a> PWA 지원 브라우저</h3> <ul><li>파이어폭스, 오페라, 크롬, 삼성 인터넷, 엣지, 사파리(push 지원X) 등</li> <li>삼성 인터넷과 크롬은 대부분의 기능을 제공한다.</li></ul> <p><img src="https://www.christianoliveira.com/blog/wp-content/uploads/2018/06/pwa-browser-compatibility-features-700x325.jpg" alt="PWA 지원 브라우저"></p> <h3 id="pwa는-실제-앱-마켓에-배포가능하다"><a href="#pwa는-실제-앱-마켓에-배포가능하다" class="header-anchor">#</a> PWA는 실제 앱 마켓에 배포가능하다?</h3> <ul><li>OS레벨까지 내려왔음</li> <li>application 관리 tab으로 존재함</li> <li>플레이스토어에 배포하기 위해서는 mapping 하는 작업이 추가로 필요할 뿐이다.</li> <li><a href="https://youtu.be/xKZ0933D7hk?t=1364" target="_blank" rel="noopener noreferrer">Google I/O 2019 웹 세션<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>에서 <strong>TWA (Trusted Web Activity)</strong> 라는 용어가 등장했는데, 이것은 Google Play에 PWA를 올릴 수 있는 App Frame 이다. App Store는 지원 예정이 없다.</li></ul> <h3 id="web-app-manifest"><a href="#web-app-manifest" class="header-anchor">#</a> Web App Manifest</h3> <p>PWA의 설치와 앱 구성정보를 담고 있는 파일 (앱 아이콘, 런쳐 방식, 배경, 시작페이지 등)</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>manifest.json<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>아래 것들이 설정될 수 있음.</p> <ul><li>start url</li> <li>launch image</li> <li>display type : 웹앱이 모바일 앱의 느낌을 가질 수 있도록 결정짓는 속성 (전체 모양)
<ul><li>Standalone (url창 사라짐)</li> <li>Browser</li> <li>Fullscreen (non-app UI 사라짐)</li> <li>Minimal-ui</li></ul></li> <li>display orientation</li> <li>App icon</li> <li>배경 색 : background color와 비슷하게 하는 것이 좋다.</li></ul> <h3 id="web-app-install-banner"><a href="#web-app-install-banner" class="header-anchor">#</a> Web App Install Banner</h3> <p>PWA가 모바일적인 특징을 가지는 큰 부분</p> <ul><li>기존 앱 개발주기 : 구현 -&gt; SDK 빌드 -&gt; 스토어 배포 -&gt; 검색 -&gt; 앱 다운로드 -&gt; 설치 -&gt; 사용</li> <li>PWA 앱 개발주기 : 구현 -&gt; 사이트 배포 -&gt; 검색 -&gt; 사용 (자동설치, 항상 최신상태 유지)</li></ul> <p><a href="https://developers.google.com/web/fundamentals/app-install-banners/native" target="_blank" rel="noopener noreferrer">install banner 동작조건<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>short name</li> <li>name</li> <li>icons (including a 192px and a 512px version)</li> <li>https</li></ul> <p>사용자가 30초만 사이트에 머무르면, install banner가 뜬다. (타이밍은 조절 가능)</p> <h3 id="service-worker"><a href="#service-worker" class="header-anchor">#</a> Service Worker</h3> <ul><li>오프라인 서비스, 푸쉬알람 등 Mobile 기능을 웹에서 가능하게 하는 코어 기술</li> <li>PWA에서 가장 중요한 역할을 한다.</li> <li>약자로 sw.js와 같이 많이 쓰임</li> <li>서버에 배포할 때 service worker를 사용하려면 https를 사용해야한다.
<a href="https://www.netlify.com/" target="_blank" rel="noopener noreferrer">Netlify<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>나 <a href="https://firebase.google.com/docs/hosting?hl=ko" target="_blank" rel="noopener noreferrer">Firebase Hosting<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>을 사용하면 간단히 https로 배포할 수 있다.</li></ul> <p><a href="/notesite/chrome:/inspect/#service-workers">chrome://inspect/#service-workers</a>
-&gt; 현재 브라우저에서 돌아가고 있는 service worker를 전부 볼 수 있는 개발자도구</p> <p><strong>주요특징</strong></p> <ul><li>Caching</li> <li>Offline (리소스를 캐싱함으로써 가능)</li> <li>Native features (push 등)</li></ul> <p>Service worker는 브라우저와 서버 사이의 별도의 js가 돌아가는 것 (미들웨어)</p> <ul><li>실제적으로는 브라우저 뒤에 별도의 쓰레드 (멀티 쓰레드 개념)가 돌아가고 있다. (scope도 다르다)</li> <li>같은 동작을 했음에도 기존 js와 결과가 다르게 나온다.</li></ul> <p>이전에도 Service worker와 비슷한 개념은 존재했다.</p> <ol><li>AppCache</li></ol> <ul><li>오프라인경험을 제공하기 위한 캐시 제공, HTML 표준</li> <li>페이지가 여러 개 일때 오동작, 파일 변화할 때 문제</li></ul> <ol start="2"><li>Shared Workers</li></ol> <ul><li>js와 별도의 쓰레드</li> <li>페이지에 비종속적 (페이지가 새로고침되더라도, js파일은 새로고침되지 않음)</li></ul> <p>이런 것들을 보완하기 위해서 등장한 것이 service worker이다.</p> <p><a href="https://developer.mozilla.org/ko/docs/Web/API/Cache" target="_blank" rel="noopener noreferrer">참고<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>service-worker.js(sw.js) 파일을 설정하기 이전에,index.html 파일의 body 태그 안에 서비스워커를 등록하는 아래 코드를 추가해야 한다.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			navigator<span class="token punctuation">.</span>serviceWorker
				<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'../service-worker.js'</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">reg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Service worker registered]'</span><span class="token punctuation">,</span> reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// #1 - 서비스 워커 설치(캐싱 파일 생성)</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'install'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// self : app.js에서의 window와 동일 - 바로 window 객체에 접근할 수 없기 때문에 사용</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'서비스 워커 설치 완료'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>
		caches
			<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'캐시 생성 완료'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>cacheFilelist<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>오프라인에서도 돌아가게끔 캐시 작업을 한 것이다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// #2 - 서비스 워커의 네트워크 요청 가로채기 코드 작성</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>
		caches
			<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span> response<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pwa-적용하는-방법"><a href="#pwa-적용하는-방법" class="header-anchor">#</a> PWA 적용하는 방법</h3> <ol><li>Vue create로 만들 때 PWA Support 옵션으로 생성</li> <li>이미 만들어진 app에 적용하려면,
<ol><li>public 폴더 밑의 index.html에 link tag로 manifest 연결</li> <li>manifest.json 생성</li> <li>main.js에 service worker 등록</li></ol></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notesite/05.html" class="prev">Render, Webpack, Vuex</a></span> <span class="next"><a href="/notesite/07.html">Deployment with Vue CLI, PWA</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/notesite/assets/js/app.7598ef95.js" defer></script><script src="/notesite/assets/js/2.2b413f48.js" defer></script><script src="/notesite/assets/js/10.af6dba14.js" defer></script><script src="/notesite/assets/js/3.9a023001.js" defer></script>
  </body>
</html>

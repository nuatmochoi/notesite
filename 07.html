<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deployment with Vue CLI, PWA | Vue.js Lecture Note</title>
    <meta name="description" content="">
    <link rel="icon" href="/notesite/images/icon-144x144.png">
  <link rel="manifest" href="/notesite/manifest.json">
    
    <link rel="preload" href="/notesite/assets/css/0.styles.096013c7.css" as="style"><link rel="preload" href="/notesite/assets/js/app.7598ef95.js" as="script"><link rel="preload" href="/notesite/assets/js/2.2b413f48.js" as="script"><link rel="preload" href="/notesite/assets/js/11.cda827c0.js" as="script"><link rel="preload" href="/notesite/assets/js/3.9a023001.js" as="script"><link rel="prefetch" href="/notesite/assets/js/10.af6dba14.js"><link rel="prefetch" href="/notesite/assets/js/12.abd301ab.js"><link rel="prefetch" href="/notesite/assets/js/13.7c59abbc.js"><link rel="prefetch" href="/notesite/assets/js/14.32cf25ee.js"><link rel="prefetch" href="/notesite/assets/js/4.a57bf471.js"><link rel="prefetch" href="/notesite/assets/js/5.48a0f058.js"><link rel="prefetch" href="/notesite/assets/js/6.33446d39.js"><link rel="prefetch" href="/notesite/assets/js/7.63882a72.js"><link rel="prefetch" href="/notesite/assets/js/8.8247d324.js"><link rel="prefetch" href="/notesite/assets/js/9.ea0270c8.js">
    <link rel="stylesheet" href="/notesite/assets/css/0.styles.096013c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notesite/" class="home-link router-link-active"><!----> <span class="site-name">Vue.js Lecture Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/notesite/" class="sidebar-link">Introduction</a></li><li><a href="/notesite/02.html" class="sidebar-link">Event, Instance, Component, Axios</a></li><li><a href="/notesite/03.html" class="sidebar-link">Directives, npm, Vue CLI, Component</a></li><li><a href="/notesite/04.html" class="sidebar-link">Event Bus, Life Cycle, ES6</a></li><li><a href="/notesite/05.html" class="sidebar-link">Render, Webpack, Vuex</a></li><li><a href="/notesite/06.html" class="sidebar-link">Router, PWA</a></li><li><a href="/notesite/07.html" class="active sidebar-link">Deployment with Vue CLI, PWA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notesite/07.html#deployment-with-vue-cli" class="sidebar-link">Deployment with Vue CLI</a></li><li class="sidebar-sub-header"><a href="/notesite/07.html#pwa-실습" class="sidebar-link">PWA 실습</a></li><li class="sidebar-sub-header"><a href="/notesite/07.html#service-worker" class="sidebar-link">Service Worker</a></li><li class="sidebar-sub-header"><a href="/notesite/07.html#pwa-caching" class="sidebar-link">PWA caching</a></li></ul></li><li><a href="/notesite/08.html" class="sidebar-link">PWA Push Web App</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="deployment-with-vue-cli-pwa"><a href="#deployment-with-vue-cli-pwa" class="header-anchor">#</a> Deployment with Vue CLI, PWA</h1> <h2 id="deployment-with-vue-cli"><a href="#deployment-with-vue-cli" class="header-anchor">#</a> Deployment with Vue CLI</h2> <p>Webpack dev server는 Node moudles @vue cli-service에 존재한다.</p> <p>dist 폴더를 찾다보면 hash값이 포함된 파일을 찾을 수 있는데, Hash값은 브라우저 캐시와 같은 역할을 한다.
새로고침하더라도 기존 상태가 남아있지 않고 최신상태를 반영하기 위함.</p> <p>Component들이 vue 파일인데, 실제 npm run serve로 올려보면 element로 tag가 생성되어 있다. 즉, app.js에서 webpack을 사용해 받아온다는 것을 확인할 수 있음.</p> <p>static file server와 webpack dev server의 차이를 잘 알아둬야 한다.</p> <ul><li>webpack dev server 포트번호 : 8080</li> <li>static file server(npm run serve) 포트번호 : 5000</li></ul> <h3 id="continuous-deployment-cd"><a href="#continuous-deployment-cd" class="header-anchor">#</a> Continuous Deployment (CD)</h3> <p>지속적으로 배포하는 것. 실시간서비스나 협업 중에 유용하게 사용된다.</p> <p><a href="https://www.netlify.com/" target="_blank" rel="noopener noreferrer">Netlify<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>배포 자동화를 도와준다. 소스변경이 일어났을 때 자동으로 배포시켜준다.</p> <p>Publish directory는 해당 repository를 배포할 대상 위치를 가리킨다.</p> <p>배포 자동화를 위해 프론트 배포는 Netlify를, 백엔드 배포는 Elastic Beanstalk을 많이 사용한다.</p> <h2 id="pwa-실습"><a href="#pwa-실습" class="header-anchor">#</a> PWA 실습</h2> <p>기존 프로젝트에 PWA를 추가하는 실습이다. workbox를 사용하여 실습을 진행하였다.</p> <p>이제는 sw-precache는 구시대 기술이다. 하지만 여전히 기업들은 많이 사용한다고 한다.</p> <ol><li></li></ol> <p>Public-index.html 에다가 추가</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>manifest<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>manifest.json<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><ol start="2"><li></li></ol> <p>public/manifest.json 생성</p> <p><a href="https://app-manifest.firebaseapp.com" target="_blank" rel="noopener noreferrer">manifest 자동 생성 툴<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>을 사용해 manifest.json을 쉽게 생성할 수 있다.</p> <ol start="3"><li></li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> workbox-cli -g
</code></pre></div><ol start="4"><li></li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> run build
</code></pre></div><ol start="5"><li></li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>workbox wizard
</code></pre></div><p>터미널에 다음과 같은 설정 사항들이 표시될 것이다.</p> <ul><li>Wabapp의 root (어디 배포하는지) - dist/</li> <li>precache - 필요한 파일들이 선택되었는지 보고 enter</li> <li>서비스 워커 저장 위치 - dist/sw.js</li> <li>설정 파일 - workbox-config.js</li></ul> <ol start="6"><li></li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code>workbox generateSW ./workbox-config.js
</code></pre></div><p>서비스 워커가 생성되었음을 확인할 수 있다.</p> <p>모든 이미지와 js 파일들을 service worker에서 들고 오기 때문에 PWA는 오프라인에서 작동이 가능하다.</p> <p>서비스 워커 파일을 직접 조작하고 커스텀하기를 원한다면 아래 스크립트를 적용한다.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>workbox injectManifest ./workbox-config.js
</code></pre></div><p>위 명령어를 실행하려고 할 때, 잘못된 swSrc 주소나, 해당 주소의 파일에 제대로 된 값이 입력되어 있지 않으면 에러가 뜬다.</p> <h2 id="service-worker"><a href="#service-worker" class="header-anchor">#</a> Service Worker</h2> <ul><li>브라우저의 백그라운드 실행(javascript의 UI thread와 별도의 동작)</li> <li>네트워크 요청 가로채기 (캐시 안에 instance가 없으면 서버에 자원 요청) -&gt; 프록시</li> <li>브라우저 종속 생명주기</li> <li>notification 제공</li></ul> <p><img src="http://www.html5rocks.com/ko/tutorials/service-worker/introduction/images/sw-lifecycle.png" alt="서비스워커생명주기"></p> <h2 id="pwa-caching"><a href="#pwa-caching" class="header-anchor">#</a> PWA caching</h2> <p>Application tap의 cache storage</p> <ul><li><p>프리캐싱
: 웹 애플리케이션 접속 전 미리 캐싱</p></li> <li><p>런타임 캐싱
: 발생하는 요청에 대해 캐시 스토리지 저장 - 정규식 사용하여 어떤 파일 패턴을 받을 것인지, 어떤 것들에 대해서 무조건 캐시로 받을 것인지 등등의 전략이 필요</p></li></ul> <h3 id="캐싱-전략"><a href="#캐싱-전략" class="header-anchor">#</a> 캐싱 전략</h3> <ul><li>cacheFirst (캐시를 네트워크 보다 먼저 요청할 것인지)
<ul><li>offline 페이지가 먼저 보여질 때 유리
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FPpDaf%2FbtqEtFqGouu%2FS6ENcKyoHWQlo6Z19AJz5k%2Fimg.png" alt="cacheFirst"></li></ul></li></ul> <ul><li>cacheOnly (캐시만 볼 것인지)
<ul><li>static file가 해당
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbpI2II%2FbtqEuAvple1%2F2IpsVdAvUWGGfBXk9PybU1%2Fimg.png" alt="cacheOnly"></li></ul></li></ul> <ul><li>networkFirst (캐시보다 네트워크를 먼저 요청할 것인지)
<ul><li>UX에 좋지 않음
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbJsKiY%2FbtqEtuQvqpM%2FbqCImrf0BePOkhnFrYBaL1%2Fimg.png" alt="networkFirst"></li></ul></li></ul> <ul><li>networkOnly (네트워크만 요청할 것인지)
<ul><li>캐시가 필요없는 GET 메소드가 아닌 method
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FTn4km%2FbtqEuzcbs0F%2FkR0h3Q2R0wp6FHSU5Z9UaK%2Fimg.png" alt="networkOnly"></li></ul></li></ul> <ul><li><p>staleWhileRevalidate (캐시 먼저, 그 다음 네트워크에서 요청된 캐시 반환)</p> <ul><li>주로 사용되는 방식
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbAL18Z%2FbtqEu7fgGl1%2FGuwZFJcrjbPit3QmYfn3b0%2Fimg.png" alt="staleWhileRevalidate"></li></ul></li> <li><p>Cache then network (캐시, 네트워크에 요청을 동시에 하고, 캐시 data 먼저 표시, 이후 네트워크 data 표시)</p> <ul><li>workbox에는 없는 전략, networkFirst보다는 UX에 좋음
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&amp;fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcXJOhR%2FbtqEuXjBAqH%2F4B0krhd20WmGw5sNqCKUbK%2Fimg.png" alt="Cache then network"></li></ul></li> <li><p><a href="https://developers.google.com/web/fundamentals/instant-and-offline/offline-cookbook" target="_blank" rel="noopener noreferrer">Offline Cookbook<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> | <a href="https://developers.google.com/web/tools/workbox/modules/workbox-strategies" target="_blank" rel="noopener noreferrer">Workbox strategies<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h3 id="workbox-routing"><a href="#workbox-routing" class="header-anchor">#</a> Workbox routing</h3> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
	<span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'http://www.example.com/(.*)'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token keyword">new</span> <span class="token class-name">self<span class="token punctuation">.</span>workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>StaleWhileRevalidate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		cacheName<span class="token operator">:</span> <span class="token string">'example-cache'</span><span class="token punctuation">,</span>
		plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
			<span class="token keyword">new</span> <span class="token class-name">self<span class="token punctuation">.</span>workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				maxEntries<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
				maxAgeSeconds<span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>정규 표현식과 workbox의 routing을 활용하여 해당하는 url 형식으로 요청이 들어올 경우 런타임 캐싱처리를 할 수 있다.</li> <li><code>self.addEventListener('fetch' ...</code> 로 네트워크 가로채기를 수행하려면 registerRoute 이후에 위치시켜야 충돌이 나지 않는다.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notesite/06.html" class="prev">Router, PWA</a></span> <span class="next"><a href="/notesite/08.html">PWA Push Web App</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/notesite/assets/js/app.7598ef95.js" defer></script><script src="/notesite/assets/js/2.2b413f48.js" defer></script><script src="/notesite/assets/js/11.cda827c0.js" defer></script><script src="/notesite/assets/js/3.9a023001.js" defer></script>
  </body>
</html>
